# Bear GitOps Payment Service Configuration
# 
# This file controls the behavior of the payment service.
# The connection_pool_size directly affects latency:
#   - < 10: Severe latency (2-5 seconds) - simulates pool exhaustion
#   - 10-24: Moderate latency (0.5-1.5 seconds) - degraded performance
#   - >= 25: Normal operation (10-50ms) - healthy

# Database configuration
database:
  connection_pool_size: 20  # Increased from 5 to handle peak payment load and prevent pool exhaustion
  max_connections: 50
  min_connections: 10
  connection_timeout_ms: 10000  # Increased from 5000 for better connection establishment
  idle_timeout_ms: 300000
  max_lifetime_ms: 1800000
  query_timeout_ms: 10000  # Increased from 30000 to prevent long blocking queries
  retry_attempts: 3
  retry_delay_ms: 1000

# Service configuration
service:
  timeout_ms: 25000
  version: "1.0.9"
  max_concurrent_requests: 100

# Payment provider configuration
payment_provider:
  timeout_ms: 15000  # Reduced from 45000 to fail faster and prevent resource blocking
  retry_attempts: 3
  retry_delay_ms: 2000
  connection_timeout_ms: 10000  # Maintained connection timeout for gateway
  circuit_breaker:
    failure_threshold: 5
    recovery_timeout_ms: 30000
    half_open_max_calls: 3

# Fraud detection service configuration
fraud_detection:
  timeout_ms: 3000  # Reduce from default to fail fast
  circuit_breaker:
    failure_threshold: 5
    timeout: 30000  # 30 seconds
    reset_timeout: 60000  # 1 minute
  retry:
    max_attempts: 2
    backoff_multiplier: 2
    initial_delay_ms: 100
  fallback:
    enabled: true
    default_action: "allow"  # or "deny" based on business requirements

# HTTP client configuration
http:
  client:
    read_timeout_ms: 30000
    connection_timeout_ms: 10000
    max_connections_per_route: 50
    max_total_connections: 200

# Monitoring and logging
monitoring:
  metrics_enabled: true
  tracing_enabled: true
  log_level: "INFO"
  slow_query_threshold_ms: 1000
  performance_monitoring:
    enabled: true
    alert_threshold_ms: 2000

# Cache configuration
cache:
  enabled: true
  ttl_seconds: 300
  max_size: 10000
  eviction_policy: "LRU"

# Error handling
error_handling:
  timeout_message: "Payment processing timeout - please try again"
  generic_error_message: "Payment processing temporarily unavailable"
  detailed_logging: true
  alert_on_errors: true