# Bear GitOps Payment Service Configuration
# 
# This file controls the behavior of the payment service.
# The connection_pool_size directly affects latency:
#   - < 10: Severe latency (2-5 seconds) - simulates pool exhaustion
#   - 10-24: Moderate latency (0.5-1.5 seconds) - degraded performance
#   - >= 25: Normal operation (10-50ms) - healthy

# Database configuration
database:
  connection_pool_size: 50  # Increased from 2 to handle peak payment load and prevent pool exhaustion
  max_connections: 50
  min_connections: 10
  connection_timeout_ms: 20000  # Increased from 5000 to handle latency spikes
  idle_timeout_ms: 300000
  max_lifetime_ms: 1800000
  query_timeout_ms: 15000  # Set to 15s as recommended for database query timeout
  retry_attempts: 3
  retry_delay_ms: 1000
  core_pool_size: 20  # Added core pool size as recommended
  max_pool_size: 50  # Added max pool size as recommended
  keep_alive_time_ms: 60000  # Added keep alive time as recommended

# Service configuration
service:
  timeout_ms: 30000  # Increased to 30s for better handling of latency spikes
  request_timeout_ms: 30000  # Added request timeout as recommended
  read_timeout_ms: 30000  # Increased to align with service timeout
  version: "1.0.9"
  max_concurrent_requests: 100

# Payment provider configuration
payment_provider:
  timeout_ms: 15000  # Set to 15s as recommended for payment gateway timeout
  retry_attempts: 3
  retry_delay_ms: 2000
  connection_timeout_ms: 5000  # Updated from 10000 as recommended for gateway
  circuit_breaker:
    failure_threshold: 5
    recovery_timeout_ms: 60000  # Set to 60s as recommended for circuit breaker timeout
    half_open_max_calls: 3

# Fraud detection service configuration
fraud_detection:
  timeout_ms: 2500  # Reduced timeout to implement faster fail-fast behavior
  retry_attempts: 2  # Reduced retry attempts to fail fast
  connection_timeout_ms: 1000  # Set faster connection timeout
  connection_pool:
    max_connections: 20  # Increased from 10 to prevent connection starvation
  circuit_breaker:
    enabled: true
    failure_threshold: 5
    timeout_ms: 30000  # 30 seconds recovery timeout
    reset_timeout: 60000  # 1 minute
  retry:
    max_attempts: 3
    backoff_ms: 100
    backoff_multiplier: 1.5
    initial_delay_ms: 100
  fallback:
    enabled: true
    default_action: "allow"  # or "deny" based on business requirements

# HTTP client configuration
http_client:
  inventory_service:
    connection_timeout_ms: 5000
    read_timeout_ms: 10000
    circuit_breaker:
      enabled: true
      failure_threshold_percent: 50
      minimum_requests: 10
      timeout_duration_ms: 30000
  fraud_detection:
    timeout: 3000  # 3 second timeout for fraud detection service

# HTTP client configuration
http:
  client:
    read_timeout_ms: 30000  # Increased from 25000 to handle latency spikes
    connection_timeout_ms: 5000  # Updated from 10000 as recommended
    max_connections_per_route: 50
    max_total_connections: 200
    fraud_detection:
      read_timeout: 2500  # Set faster read timeout for fraud detection
      connect_timeout: 1000  # Set faster connect timeout for fraud detection

# Circuit breaker configuration
circuit_breaker:
  fraud_detection:
    failure_threshold: 5
    recovery_timeout: 30s

# Retry configuration
retry:
  fraud_detection:
    max_attempts: 3
    backoff_multiplier: 1.5

# Monitoring and logging
monitoring:
  metrics_enabled: true
  tracing_enabled: true
  log_level: "INFO"
  slow_query_threshold_ms: 1000
  performance_monitoring:
    enabled: true
    alert_threshold_ms: 2000

# Cache configuration
cache:
  enabled: true
  ttl_seconds: 300
  max_size: 10000
  eviction_policy: "LRU"

# Error handling
error_handling:
  timeout_message: "Payment processing timeout - please try again"
  generic_error_message: "Payment processing temporarily unavailable"
  detailed_logging: true
  alert_on_errors: true